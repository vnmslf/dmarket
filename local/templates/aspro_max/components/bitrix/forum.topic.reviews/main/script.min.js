!function(e){BX.namespace("BX.Forum");var t=function(e){if(this.id="FTRList"+e.form.id,this.mess={},this.form=e.form,e.id)for(var t=0;t<e.id.length;t++)this.bind(e.id[t]);this.params={preorder:"Y"==e.preorder,pageNumber:e.pageNumber,pageCount:e.pageCount},BX.addCustomEvent(this.form,"onAdd",BX.delegate(this.add,this)),BX.addCustomEvent(this.form,"onRequest",BX.delegate((function(){if(void 0!==this.params.pageNumber){var e=this.form.elements.pageNumber;e||(e=BX.create("input",{props:{type:"hidden",name:"pageNumber"}}),this.form.appendChild(e)),e.value=this.params.pageNumber}if(void 0!==this.params.pageCount){var t=BX.findChild(this.form,{attr:{name:"pageCount"}});t||(t=BX.create("input",{props:{type:"hidden",name:"pageCount"}}),this.form.appendChild(t)),t.value=this.params.pageCount}}),this)),BX.addCustomEvent(this.form,"onResponse",BX.delegate((function(){var e=BX.findChild(this.form,{attr:{name:"pageNumber"}},!0);e&&BX.remove(e)}),this))};t.prototype={add:function(t,i){var s,a=BX(this.form.id+"container"),r={className:/reviews-reply-form|reviews-collapse/},o=BX.findChild(document,{className:"reviews-reply-form"},!0),n=e.fTextToNode(i.message);if(a||(a=BX.create("div",{attrs:{id:this.form.id+"container"},props:{className:"reviews-block-container reviews-reviews-block-container"},children:[BX.create("div",{props:{className:"reviews-block-outer"},children:[BX.create("div",{props:{className:"reviews-block-inner"}})]})]}),o.parentNode.insertBefore(a,o.nextSibling),a=BX(this.form.id+"container")),s=a?BX.findChild(a,{className:"reviews-block-inner"},!0):null,n&&s){if(i.allMessages){if(e.fReplaceOrInsertNode(n,s,BX.findChild(document,r,!0).parentNode,r),i.navigation&&i.pageNumber){var d,l=e.fTextToNode(i.navigation),h=l?BX.findChildren(a.parentNode,{className:"reviews-navigation-box"},!0):null;if(l){if(!h){a.parentNode.insertBefore(BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-top"}}),a);var c=a;do{c=c.nextSibling}while(c&&1!=c.nodeType);var m=BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-bottom"}});c?a.parentNode.insertBefore(m,c):a.parentNode.appendChild(m),h=BX.findChildren(a.parentNode,{className:"reviews-navigation-box"},!0)}for(d=0;d<h.length;d++)h[d].innerHTML=l.innerHTML}this.params.pageNumber=i.pageNumber,this.params.pageCount=i.pageCount}if(i.messagesID&&"object"==typeof i.messagesID)for(var p=0;p<i.messagesID.length;p++)i.messagesID[p]!=t&&this.bind(i.messagesID[p])}else void 0!==i.message&&(this.params.preorder?s.appendChild(n):s.insertBefore(n,s.firstChild));e.fRunScripts(i.message),this.bind(t)}},bind:function(e){var t=BX("message"+e);if(t){this.mess["m"+e]={node:t,author:{id:t.getAttribute("bx-author-id"),name:t.getAttribute("bx-author-name")}};var i=BX.findChildren(t,{tagName:"A",className:"reviews-button-small"},!0),s=BX.delegate((function(){var t=BX.proxy_context;this.act(t.getAttribute("bx-act"),e)}),this),a=BX.delegate((function(){this.act("reply",e)}),this),r=BX.delegate((function(){this.act("quote",e)}),this);if(i&&i.length>0)for(var o=0;o<i.length;o++)"moderate"==i[o].getAttribute("bx-act")||"del"==i[o].getAttribute("bx-act")?BX.adjust(i[o],{events:{click:s},attrs:{"bx-href":i[o].getAttribute("href"),href:"javascript:void(0);"}}):this.form&&("reply"==i[o].getAttribute("bx-act")?BX.bind(i[o],"click",a):"quote"==i[o].getAttribute("bx-act")&&BX.bind(i[o],"mousedown",r))}},act:function(t,i){if(i&&this.mess["m"+i])if("quote"==t){var s=e.GetSelection();if(document.getSelection&&(s=(s=s.replace(/\r\n\r\n/gi,"_newstringhere_").replace(/\r\n/gi," ")).replace(/  /gi,"").replace(/_newstringhere_/gi,"\r\n\r\n")),""===s&&i>0&&BX("message_text_"+i,!0)){var a=BX("message_text_"+i,!0);"object"==typeof a&&a&&(s=a.innerHTML)}s=(s=(s=(s=(s=(s=(s=(s=(s=(s=s.replace(/[\n|\r]*<br(\s)*(\/)*>/gi,"\n")).replace(/<script[^>]*>/gi,"").replace(/<\/script[^>]*>/gi,"")).replace(/\001([^\002]*)\002/gi,(function(e,t){var i=" ",s=/showWMVPlayer.*?bx_wmv_player.*?file:[\s'"]*([^"']*).*?width:[\s'"]*([^"']*).*?height:[\s'"]*([^'"]*).*?/gi.exec(t);if(s&&(i="[VIDEO WIDTH="+s[2]+" HEIGHT="+s[3]+"]"+s[1]+"[/VIDEO]")," "==i){(s=/bxPlayerOnload[\s\S]*?[\s'"]*file[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*height[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*width[\s'"]*:[\s'"]*([^"']*)/gi.exec(t))&&(i="[VIDEO WIDTH="+s[3]+" HEIGHT="+s[2]+"]"+s[1]+"[/VIDEO]")}return i}))).replace(/<noscript[^>]*>/gi,"").replace(/<\/noscript[^>]*>/gi,"")).replace(/\003([^\004]*)\004/gi," ")).replace(/<table class\=[\"]*forum-quote[\"]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,"")).replace(/<table class\=[\"]*forum-code[\"]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,"")).replace(/<table class\=[\"]*data-table[\"]*>[^<]*<tbody>/gi,"")).replace(/<\/td>[^<]*<\/tr>(<\/tbody>)*<\/table>/gi,"")).replace(/[\r|\n]{2,}([\001|\002])/gi,"\n$1");for(var r=0;r++<50&&(s.search(/\002([^\002\003]*)\003/gi)>=0||s.search(/\001([^\001\003]*)\003/gi)>=0);)s=s.replace(/\002([^\002\003]*)\003/gi,"[CODE]$1[/CODE]").replace(/\001([^\001\003]*)\003/gi,"[QUOTE]$1[/QUOTE]");var o=function(e,t,i){for(var s=new RegExp("([^]*)("+t+")([^]*)","i"),a=new RegExp("((?:)(?:[^]*))("+t+")((?:[^]*)(?:))","i"),r=0;r++<300&&e.search(s)>=0;)e=e.replace(a,"$1"+i+"$3");return e};for(r=0;r++<10&&s.search(/\004([^\004\003]*)\003/gi)>=0;)s=o(s,"<tr>","[TR]"),s=o(s,"</tr>","[/TR]"),s=o(s,"<td>","[TD]"),s=(s=o(s,"</td>","[/TD]")).replace(/\004([^\004\003]*)\003/gi,"[TABLE]$1[/TD][/TR][/TABLE]");s=(s=(s=(s=(s=(s=(s=BX.browser.IsIE()?s.replace(/<img(?:(?:\s+alt\s*=\s*\"?smile([^\"\s]+)\"?)|(?:\s+\w+\s*=\s*[^\s>]*))*>/gi,"$1"):s.replace(/<img.*?alt=[\"]*smile([^\"\s]+)[\"]*[^>]*>/gi,"$1")).replace(/<a[^>]+href=[\"]([^\"]+)\"[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]")).replace(/<a[^>]+href=[\']([^\']+)\'[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]")).replace(/<[^>]+>/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"')).replace(/(smile(?=[:;8]))/g,"")).replace(/\&shy;/gi,"")).replace(/\&nbsp;/gi," "),BX.onCustomEvent(this.form,"onQuote",[{author:this.mess["m"+i].author,id:i,text:s}])}else if("reply"==t)BX.onCustomEvent(this.form,"onReply",[{author:this.mess["m"+i].author,id:i}]);else if("del"!=t||confirm(BX.message("f_cdm"))){if("moderate"==t||"del"==t){var n=BX.proxy_context,d=n.getAttribute("bx-href").replace(/.AJAX_CALL=Y/g,"").replace(/.sessid=[^&]*/g,""),l=BX.findParent(n,{tag:"table"}),h=BX.create("a",{attrs:{className:"reply-action-note"}}),c=function(){BX.remove(h),BX.show(n.parentNode)};BX.hide(n.parentNode),h.innerHTML=BX.message("f_wait"),n.parentNode.parentNode.appendChild(h),BX.ajax.loadJSON(d,{AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},BX.delegate((function(i){if(i.status&&l)if(BX.onCustomEvent(e,"onForumCommentAJAXAction",[t]),"del"==t){var s=e.curpage||top.window.location.href;BX.fx.hide(l,"scroll",{time:.15,callback_complete:BX.delegate((function(){BX.remove(l),c();var e=BX.findChild(BX(this.form.id+"container"),{class:"reviews-post-table"},!0,!0);(!e||e.length<1)&&this.params.pageNumber>1&&BX.reload(s)}),this)})}else{var a=BX.hasClass(l,"reviews-post-hidden"),r=a?BX.message("f_hide"):BX.message("f_show"),o=BX.findChild(l,{className:"reviews-text"},!0);BX.fx.hide(o,"fade",{time:.1,callback_complete:function(){BX.toggleClass(l,"reviews-post-hidden"),n.innerHTML=r,d=d.replace(new RegExp("REVIEW_ACTION="+(a?"SHOW":"HIDE")),"REVIEW_ACTION="+(a?"HIDE":"SHOW")),n.setAttribute("bx-href",d),BX.fx.show(o,"fade",{time:.1}),c(),BX.style(o,"background-color",a?"#FFFFFF":"#E5F8E3")}})}else BX.addClass(h,"error"),h.innerHTML='<span class="errortext">'+i.message+"</span>"}),this))}}else BX.DoNothing();else BX.DoNothing();return!1}};var i,s=((i=function(e,t){if(this.id="FTRForm"+e.form.id,this.form=e.form,this.editor=t,this.windowEvents={},this.params={messageMax:64e3},this.onsuccess=BX.delegate(this.onsuccess,this),this.onfailure=BX.delegate(this.onfailure,this),this.submit=BX.delegate(this.submit,this),BX.bind(this.form,"submit",this.submit),this.isAjax="Y"==e.ajaxPost,"Y"==e.captcha){var i=new Captcha(this.form);BX.addCustomEvent(t,"OnContentChanged",BX.proxy(i.Show,i)),BX.ready((function(){BX.bind(BX("forum-refresh-captcha"),"click",BX.proxy(i.Update,i))})),"Y"==e.bVarsFromForm&&i.Show()}BX.addCustomEvent(this.form,"onQuote",BX.delegate((function(e){this.show(),this.quote(e)}),this)),BX.addCustomEvent(this.form,"onReply",BX.delegate((function(e){this.show(),this.paste(e)}),this)),BX.addCustomEvent(this.form,"onTransverse",BX.delegate(this.transverse,this))}).prototype={submit:function(t){if(this.validate()){if(this.prepareForm(),this.disableButtons(!0),!this.isAjax)return!0;this.form.querySelector(".captcha-row")&&"undefined"!=typeof grecaptcha?e.renderRecaptchaById&&e.asproRecaptcha&&e.asproRecaptcha.key&&("invisible"==e.asproRecaptcha.params.recaptchaSize?grecaptcha.execute($(this.form).find(".g-recaptcha").data("widgetid")).then((()=>{this.send()})):"3"===e.asproRecaptcha.ver&&grecaptcha.execute(e.asproRecaptcha.key,{action:"maxscore"}).then((e=>{const t=this.form.querySelector(".g-recaptcha-response");t&&(t.value=e),this.send()}))):this.send()}return BX.PreventDefault(t)},prepareForm:function(){},disableButtons:function(e){for(var t=this.form.getElementsByTagName("input"),i=0;i<t.length;i++)"submit"==t[i].getAttribute("type")&&(t[i].disabled=!1!==e)},validate:function(){this.editor.SaveContent();var e="",t=this.editor.GetContent().length;return this.form.TITLE&&this.form.TITLE.value.length<=0&&(e+=BX.message("no_topic_name")),t<=0?e+=BX.message("no_message"):t>64e3&&(e+=BX.message("max_len").replace(/#MAX_LENGTH#/gi,64e3).replace(/#LENGTH#/gi,t)),""===e||(alert(e),!1)},busy:!1,send:function(){return!0!==this.busy&&(this.busy=!0,this.form.elements.dataType||this.form.appendChild(BX.create("input",{props:{type:"hidden",name:"dataType",value:"json"}})),BX.onCustomEvent(this.form,"onRequest",[this.form,this]),BX.ajax.submitAjax(this.form,{method:"POST",url:this.form.action,dataType:"json",onsuccess:this.onsuccess,onfailure:this.onfailure}),!0)},onsuccess:function(e){this.busy=!1,this.disableButtons(!1),BX.onCustomEvent(this.form,"onResponse",[this.form,this]),this.get(e)},onfailure:function(){BX.onCustomEvent(this.form,"onResponse",[this.form,this]),BX.reload()},get:function(t){if(e.curpage=e.curpage||top.window.location.href,BX.onCustomEvent(e,"onForumCommentAJAXPost",[t,this.form]),void 0===t||t.reload)BX.reload(e.curpage);else{if(t.status){if(t.allMessages||void 0!==t.message)BX.onCustomEvent(this.form,"onAdd",[t.messageID,t]),this.clear();else if(t.previewMessage){var i=BX.findChild(document,{className:"reviews-preview"},!0),s=BX.findChild(document,{className:/reviews-reply-form|reviews-collapse/},!0).parentNode,a=e.fTextToNode(t.previewMessage);e.fReplaceOrInsertNode(a,i,s,{className:/reviews-reply-form|reviews-collapse/}),e.PostFormAjaxStatus(""),e.fRunScripts(t.previewMessage)}var r=t.messageID?BX("message"+t.messageID):null;r&&BX.scrollToNode(r)}e.PostFormAjaxStatus(t.statusMessage)}},clear:function(){this.editor.CheckAndReInit(""),this.editor.fAutosave&&BX.bind(this.editor.pEditorDocument,"keydown",BX.proxy(this.editor.fAutosave.Init,this.editor.fAutosave));var e=BX.findChild(document,{className:"reviews-preview"},!0);e&&BX.remove(e);for(var t,i,s,a=0;(t=BX("upload_files_"+a+++"_"+this.form.index.value))&&t;)(i=BX.findChild(t,{tagName:"input"},!0))&&BX(i)&&((s=BX.clone(i)).value="",i.parentNode.insertBefore(s,i),i.parentNode.removeChild(i)),BX.hide(t);var r=BX.findChild(this.form,{className:"forum-upload-file-attach"},!0);r&&BX.show(r);var o=BX.findChild(this.form,{className:"reviews-upload-info"},!0);o&&BX.hide(o);var n=null,d=BX.findChild(this.form,{attr:{name:"captcha_code"}},!0),l=BX.findChild(this.form,{attr:{name:"captcha_word"}},!0),h=BX.findChild(this.form,{className:"reviews-reply-field-captcha-image"},!0);h&&(n=BX.findChild(h,{tag:"img"})),d&&l&&n&&(l.value="",BX.ajax.getCaptcha((function(e){d.value=e.captcha_sid,n.src="/bitrix/tools/captcha.php?captcha_code="+e.captcha_sid})))},show:function(){return BX.onCustomEvent(this.form,"onBeforeShow",[this]),BX.show(this.form.parentNode),BX.scrollToNode(BX.findChild(this.form,{attribute:{name:"send_button"}},!0)),setTimeout(BX.delegate((function(){this.editor.Focus(),BX.defer(this.editor.Focus,this.editor)()}),this),100),BX.onCustomEvent(this.form,"onAfterShow",[this]),!1},hide:function(){return BX.onCustomEvent(this.form,"onBeforeHide",[this]),BX.hide(this.form.parentNode),BX.onCustomEvent(this.form,"onAfterHide",[this]),!1},transverse:function(){return"none"==this.form.parentNode.style.display?this.show():this.hide(),!1},quote:function(e){BX.onCustomEvent(this.form,"onPaste",[e,"QUOTE",this]);var t=e.author||null,i=e.text||"";"wysiwyg"==this.editor.GetViewMode()?(i=i.replace(/</gi,"&lt;").replace(/>/gi,"&gt;").replace(/\n/g,"<br/>"),t&&(i=(t=""!=(t=t.id>0?'<span id="'+this.editor.SetBxTag(!1,{tag:"postuser",params:{value:t.id}})+'" class="bxhtmled-metion">'+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>":"<span>"+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>")?t+BX.message("f_author")+"<br/>":"")+i)):this.editor.bbCode&&t&&(i=(t=""!==(t=t.id>0?"[USER="+t.id+"]"+t.name+"[/USER]":t.name)?t+BX.message("f_author")+"\n":"")+i),this.editor.action.actions.quote.setExternalSelection(i),this.editor.action.Exec("quote")},paste:function(e){BX.onCustomEvent(this.form,"onPaste",[e,"REPLY",this]);var t=e.author||null;if(t)if("wysiwyg"==this.editor.GetViewMode()){var i=this.editor.GetIframeDoc(),s=this.editor.selection.GetRange(),a=BX.create("SPAN",{props:{className:"bxhtmled-metion"},text:BX.util.htmlspecialcharsback(t.name)},i),r=BX.create("SPAN",{html:",&nbsp;"},i);if(this.editor.SetBxTag(a,{tag:"postuser",params:{value:t.id}}),this.editor.selection.InsertNode(a,s),a&&a.parentNode){var o=BX.findParent(a,{className:"bxhtmled-metion"},i.body);o&&this.editor.util.InsertAfter(a,o)}a&&a.parentNode&&(this.editor.util.InsertAfter(r,a),this.editor.selection.SetAfter(r))}else"code"==this.editor.GetViewMode()&&this.editor.bbCode&&(this.editor.textareaView.Focus(),this.editor.textareaView.WrapWith(!1,!1,"[USER="+t.id+"]"+t.name+"[/USER],"))}},i),a=[];BX.Forum.Init=function(i){if(i&&"object"==typeof i){var s,o;for(new t(i);(s=a.pop())&&s;)BX.removeCustomEvent(e,"OnEditorInitedAfter",s);o=function(t){r(t,i),BX.removeCustomEvent(e,"OnEditorInitedAfter",o)},a.push(o),BX.addCustomEvent(e,"OnEditorInitedAfter",o)}};var r=function(e,t){e.id==t.lheId&&(e.insertImageAfterUpload=!0,BX.bind(BX("post_message_hidden"),"focus",(function(){e.Focus()})),new s(t,e))};BX.ready((function(){if(BX.browser.IsIE()){var e,t,i,s=BX.findChildren(document,{className:"reviews-post-table"},!0);if(!s)return;for(e=0;e<s.length;e++)for(i=(t=s[e].getElementsByTagName("*")).length;i--;)t[i].scrollWidth>t[i].offsetWidth&&(t[i].style.paddingBottom="20px",t[i].style.overflowY="hidden")}})),e.fTextToNode=function(e){var t=BX.create("div");return t.innerHTML=e,t.childNodes.length>0?t:null},e.PostFormAjaxStatus=function(t){var i,s=BX.findChild(document,{className:"reviews-note-box"},!0,!0);if(s)for(i=0;i<=s.length;i++)BX.remove(s[i]);if(!(t.length<1)){var a=e.fTextToNode(t);if(a){var r=BX.findChild(document,{className:"reviews-reply-form"},!0);r.parentNode.insertBefore(a,r)}}},e.SetReviewsAjaxPostTmp=function(t){e.forumAjaxPostTmp=t},e.fReplaceOrInsertNode=function(t,i,s,a){var r=null;return!!BX.type.isDomNode(s)&&(!(!BX.type.isDomNode(t)&&!BX.type.isArray(t)&&t.length>0&&!(t=e.fTextToNode(t)))&&(BX.type.isDomNode(i)&&(s=i.parentNode,r=i.nextSibling,s.removeChild(i)),r||(r=BX.findChild(s,a,!0)),r?r.parentNode.insertBefore(t,r):s.appendChild(t),!0))},e.fRunScripts=function(e){var t=BX.processHTML(e,!0);BX.ajax.processScripts(t.SCRIPT,!0)},e.ShowLastEditReason=function(e,t){t&&(t.style.display=e?"block":"none")},e.AttachFile=function(e,t,i,s){var a=null,r=!1;e=parseInt(e),t=parseInt(t),document.getElementById("upload_files_info_"+i).style.display="block";for(var o=e;o<e+t&&((a=document.getElementById("upload_files_"+o+"_"+i))&&null!==typeof a);o++)if("none"==a.style.display){r=!0,a.style.display="block";break}!0===(!r||o>=e+t-1)&&(s.style.display="none")},e.GetSelection=function(){var t="";return e.getSelection?t=e.getSelection().toString():document.selection&&(t=document.selection.createRange().text),t}}(window);